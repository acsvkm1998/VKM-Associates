<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Owner Dashboard - VKM Associates</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="header">
  <div class="logo"><a href="index.html">VKM ASSOCIATES</a></div>
  <nav class="nav"><ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="stationery.html">Stationeries</a></li>
    <li><a href="furniture.html">Office Furniture</a></li>
    <li><a href="contact.html">Contact Us</a></li>
  </ul></nav>
  <a href="#" class="cta-button" id="logoutBtn" style="display:none;">Logout</a>
</header>

<section class="service-highlights" style="max-width:980px;margin:30px auto;">
  <div class="highlight-card" style="grid-column:1/-1;">
    <h3>Owner Login</h3>
    <div id="loginBox">
      <input id="ownerUser" placeholder="Username" style="padding:8px;margin-right:8px;">
      <input id="ownerPass" type="password" placeholder="Password" style="padding:8px;margin-right:8px;">
      <button class="cta-button" id="loginBtn">Login</button>
      <p style="color:#666;margin-top:8px;">Use VKM2009 / VKM1998</p>
    </div>
    <div id="ownerOK" style="display:none;margin-top:10px;">Logged in as Owner.</div>
  </div>

  <div class="highlight-card" id="logoCard" style="display:none;">
    <h3>Upload Business Logo</h3>
    <input type="file" id="logoFile" accept="image/*">
    <button class="cta-button" id="saveLogoBtn" style="margin-top:10px;">Save Logo</button>
  </div>

  <div class="highlight-card" id="productCard" style="display:none;">
    <h3>Add Product</h3>
    <div style="display:grid;gap:10px;">
      <input id="pName" placeholder="Product name">
      <select id="pCat">
        <option>Stationery</option>
        <option>Furniture</option>
        <option>Printing</option>
      </select>
      <input id="pPrice" type="number" step="0.01" placeholder="Price (Rs)">
      <input id="pStock" type="number" placeholder="Stock">
      <textarea id="pDesc" placeholder="Description"></textarea>
      <input id="pImg" type="file" accept="image/*">
      <button class="cta-button" id="saveProduct">Save Product</button>
    </div>
  </div>
</section>

<footer class="footer"><p>&copy; 2025 VKM ASSOCIATES</p></footer>

<script src="db.js"></script>
<script>
  (async function(){
    await VKM.init();

    // UI helpers
    const $ = sel => document.querySelector(sel);
    const show = (el, v=true) => el.style.display = v ? '' : 'none';

    // Auth controls
    const loginBox = $('#loginBox'), ownerOK = $('#ownerOK'), logoutBtn = $('#logoutBtn');
    const logoCard = $('#logoCard'), productCard = $('#productCard');

    function refreshAuthUI() {
      const owner = VKM.isOwner();
      show(loginBox, !owner);
      show(ownerOK, owner);
      show(logoCard, owner);
      show(productCard, owner);
      show(logoutBtn, owner);
    }

    $('#loginBtn').addEventListener('click', async () => {
      const ok = await VKM.loginOwner($('#ownerUser').value.trim(), $('#ownerPass').value.trim());
      alert(ok ? 'Login successful' : 'Invalid credentials');
      refreshAuthUI();
    });

    logoutBtn.addEventListener('click', () => { VKM.logoutOwner(); refreshAuthUI(); });

    // Save logo
    $('#saveLogoBtn').addEventListener('click', async () => {
      const f = $('#logoFile').files[0];
      if (!f) return alert('Please choose a logo file.');
      await VKM.setLogo(f);
      alert('Logo saved. It will appear in the header on all pages.');
    });

    // Save product
    $('#saveProduct').addEventListener('click', async () => {
      const name = $('#pName').value.trim();
      if (!name) return alert('Enter product name.');
      const file = $('#pImg').files[0];
      const imageMediaId = file ? await VKM.saveMedia(file) : null;

      await VKM.addProduct({
        name,
        category: $('#pCat').value,
        price: parseFloat($('#pPrice').value || '0'),
        stock: parseInt($('#pStock').value || '0', 10),
        description: $('#pDesc').value.trim(),
        imageMediaId
      });

      alert('Product saved. Open Home/Stationery to see it.');
      // reset simple fields
      $('#pName').value = ''; $('#pPrice').value = ''; $('#pStock').value = ''; $('#pDesc').value = ''; $('#pImg').value = '';
    });

    refreshAuthUI();
  })();
</script>
</body>
</html>
